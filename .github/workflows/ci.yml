# ğŸ§  Nome da pipeline
# Esse nome serÃ¡ exibido na aba "Actions" do GitHub
name: Run Geological Feature Identifier (GFI Pipeline)

# ğŸš€ Quando o workflow serÃ¡ executado?
# O workflow serÃ¡ acionado automaticamente quando houver:
# - um "push" para o branch main
# - uma "pull request" para o branch main
on:
  push:
    branches: [main]
  pull_request:
    branches: [main]

# ğŸ“¦ DefiniÃ§Ã£o do job principal da pipeline
jobs:
  run-gfi:
    # ğŸ–¥ï¸ Ambiente onde o job serÃ¡ executado
    runs-on: ubuntu-latest  # Sistema Ubuntu mais recente, preparado pelo GitHub

    # ğŸ” Etapas do pipeline (executadas em ordem)
    steps:

    # ğŸ“¥ Etapa 1: Clona o repositÃ³rio para a mÃ¡quina virtual do GitHub
    - name: Clonar repositÃ³rio
      uses: actions/checkout@v3

    # ğŸ Etapa 2: Configura o ambiente Python
    # Instala a versÃ£o 3.10 do Python para o restante do workflow
    - name: Configurar Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.10'

    # ğŸ“¦ Etapa 3: Instala todas as dependÃªncias necessÃ¡rias
    # O arquivo requirements.txt deve conter:
    # - torch
    # - torchvision
    # - opencv-python
    # - matplotlib
    # - seaborn
    - name: Instalar dependÃªncias
      run: |
        python -m pip install --upgrade pip
        pip install -r requirements.txt

    # ğŸ§  Etapa 4: Executa o script de treinamento
    # Essa etapa cria o modelo treinado "cnn_seismic_model.pth"
    - name: Treinar modelo com train.py
      run: |
        python train.py

    # ğŸ” Etapa 5: Executa a inferÃªncia com GFI.py
    # Usa OpenCV para detectar regiÃµes e a CNN para classificar falha/dobra/fundo
    - name: Rodar identificador geolÃ³gico com GFI.py
      run: |
        python GFI.py
